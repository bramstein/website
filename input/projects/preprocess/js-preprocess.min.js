/*
 * JavaScript Preprocessor v0.32
 *
 * Licensed under the new BSD License.
 * Copyright 2009, Bram Stein
 * All rights reserved.
 */
var preprocess=function(d,b){var a=[],e,c=function(h){var k=/^\s*#(ifdef|ifndef|endif|else|define|undef|.*)\s*(\w*)$/,i=0,g;function j(m,l,n){return{id:m,value:l,position:n,toString:function(){return this.id+' = "'+this.value+'", at: '+this.position+"\n"}}}return{hasNext:function(){return i<h.length},next:function(){if(i<h.length){g=k.exec(h[i]);i+=1;if(g){return j(g[1],g[2],i)}else{return j("line",h[i-1],i)}}return false}}},f=function(t,r){var q,k,m=c(t),u=[],s=[],i=Object.prototype.toString.apply(r)==="[object Object]"&&r||{};function o(){var w=0,v=s.length,l=true;for(;w<v;w+=1){l=l&&s[w]}return l}function h(){var v=k.id==="ifndef",l=k.value;if(!v&&i[l]||v&&!i[l]){s.push(true)}else{s.push(false)}n();s.pop();if(k.id==="else"){if(!v&&!i[l]||v&&i[l]){s.push(true)}else{s.push(false)}n();s.pop()}if(k.id==="endif"){return true}throw"Missing #endif at line: "+q.position}function g(){var v=k.id==="define",l=k.value;if(v&&o()){i[l]=true}else{if(o()){delete i[l]}}return true}function j(){if(o()){u.push(k.value)}return true}function p(){q=k;k=m.next();if(k){if(k.id==="ifdef"||k.id==="ifndef"){return h()}else{if(k.id==="define"||k.id==="undef"){return g()}else{if(k.id==="line"){return j()}}}}return false}function n(){while(p()){}return true}return{parse:function(){s.push(true);n();if(m.hasNext()||k.id==="else"){throw'Unexpected statement: "'+k.id+'" at line: '+k.position}s.pop();return u}}};if(typeof d==="string"){a=d.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n")}else{a=d}e=f(a,b);return e.parse()};if(typeof self!=="undefined"&&self.getTaskName!=="undefined"&&self.getTaskName()+""==="preprocess"){var ant=function(){importClass(java.io.FileWriter);importClass(java.io.File);importClass(Packages.org.apache.tools.ant.util.FileUtils);importClass(java.io.FileReader);var s=attributes.get("defines"),f=attributes.get("todir"),g=attributes.get("file"),d=attributes.get("tofile"),o=elements.get("fileset"),a=[],n=0,m=0,h=0,q,b=[],c={},r=function(e){return""+FileUtils.readFully(new FileReader(e)).toString()};s=(s+"").split(/,\s?/);for(;h<s.length;h+=1){c[s[h]]=true}if(g){if(d||f){a.push({src:new File(project.getBaseDir(),g),dst:new File(project.getBaseDir(),d||f)})}else{self.fail('Please specify a destination using either the "tofile" or "todir" attribute.')}}else{if(o){if(f){for(;n<o.size();n+=1){q=o.get(n);b=q.getDirectoryScanner(project).getIncludedFiles();for(;m<b.length;m+=1){a.push({src:new File(q.getDir(project),b[m]),dst:new File(new File(project.getBaseDir(),f),b[m])})}}}else{self.fail('Please specify a destination using the "todir" attribute.')}}}for(n=0;n<a.length;n+=1){var k,t=[];self.log("Preprocessing: "+a[n].dst.toString());try{t=preprocess(r(a[n].src),c)}catch(p){self.fail(p)}a[n].dst.getParentFile().mkdirs();k=new FileWriter(a[n].dst);k.write(t.join("\n"));k.close()}};ant()}if(typeof arguments!=="undefined"&&typeof readFile!=="undefined"){var cmd=function(a){var b,d={},c=1;if(!a[0]){print("Usage: js-preprocess.js file.js [defines, ...]");return 1}b=readFile(a[0]);if(!b){print("preprocess: Couldn't open file \""+a[0]+'".');return 1}for(;c<a.length;c+=1){d[a[c]]=true}try{print(preprocess(b,d).join("\n"))}catch(f){print(f);return 2}return 0};cmd(arguments)};